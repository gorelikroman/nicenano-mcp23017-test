#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–æ—à–∏–≤–∫–∏ Nice!Nano v2 —Å MCP23017

echo "üîß –°–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ø—Ä–æ—à–∏–≤–∫–∏ Nice!Nano v2 + MCP23017..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ west
if ! command -v west &> /dev/null; then
    echo "‚ùå West –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Zephyr SDK –∏ west."
    echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: https://docs.zephyrproject.org/latest/getting_started/index.html"
    exit 1
fi

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
if [ ! -d ".west" ]; then
    echo "üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è west..."
    west init -l config
fi

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
west update

# –≠–∫—Å–ø–æ—Ä—Ç Zephyr
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Zephyr..."
west zephyr-export

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏
echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏..."
west build -p -s zmk/app -b nice_nano_v2 -- -DSHIELD=nicenano_test -DZMK_CONFIG="$(pwd)/config"

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    echo "üìÅ –ü—Ä–æ—à–∏–≤–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: build/zephyr/zmk.uf2"
    echo ""
    echo "üîå –î–ª—è –ø—Ä–æ—à–∏–≤–∫–∏:"
    echo "1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Nice!Nano v2 –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É"
    echo "2. –î–≤–∞–∂–¥—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É RESET"
    echo "3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ zmk.uf2 –Ω–∞ –ø–æ—è–≤–∏–≤—à–∏–π—Å—è –¥–∏—Å–∫ NICENANO"
    echo ""
    echo "üß™ –ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏:"
    echo "1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ MCP23017 –∫ –ø–∏–Ω–∞–º SCL(D20) –∏ SDA(D21)"
    echo "2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –∫ GPIO –ø–∏–Ω–∞–º"
    echo "3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–∂–∞—Ç–∏—è - –¥–æ–ª–∂–Ω—ã –ø–µ—á–∞—Ç–∞—Ç—å—Å—è —Å–∏–º–≤–æ–ª—ã"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!"
    exit 1
fi
